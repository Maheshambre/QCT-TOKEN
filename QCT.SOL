// MAHESH AMBRE { MAYA }
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC20/ERC20.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

contract QuantityCycleToken is ERC20, Ownable {

    uint256 public constant MAX_SUPPLY = 100_000_000_000 * 1e18;
    uint256 public constant BIG_HOLDER_THRESHOLD = 10_000_000 * 1e18;

    uint256 public immutable startTimestamp;
    uint256 public constant BASE_PRICE_RS = 1000;
    uint256 public constant SECONDS_PER_DAY = 1 days;
    uint256 public constant SECONDS_PER_YEAR = 365 days;

    constructor()
        ERC20("QuantityCycleToken", "QCT")
        Ownable(msg.sender)   // âœ… FIX IS HERE
    {
        startTimestamp = block.timestamp;
        _mint(msg.sender, MAX_SUPPLY);
    }

    /* ---------------------------------------------------------- */
    /*                       HOLDER TYPE                          */
    /* ---------------------------------------------------------- */

    function isBigHolder(address user) public view returns (bool) {
        return balanceOf(user) >= BIG_HOLDER_THRESHOLD;
    }

    /* ---------------------------------------------------------- */
    /*                     TIME CALCULATIONS                      */
    /* ---------------------------------------------------------- */

    function currentDay() public view returns (uint256) {
        return (block.timestamp - startTimestamp) / SECONDS_PER_DAY;
    }

    function currentYear() public view returns (uint256) {
        return (block.timestamp - startTimestamp) / SECONDS_PER_YEAR;
    }

    /* ---------------------------------------------------------- */
    /*                  PRICE CALCULATION LOGIC                   */
    /* ---------------------------------------------------------- */

    function baseValueForYear() public view returns (uint256) {
        uint256 year = currentYear();
        return BASE_PRICE_RS * (2 ** year);
    }

    function cakePrice(address buyer) public view returns (uint256) {
        bool big = isBigHolder(buyer);
        bool evenDay = currentDay() % 2 == 0;

        uint256 baseValue = baseValueForYear();

        // Even day: small cheap, big expensive
        // Odd day: big cheap, small expensive
        bool cheapForBig = !evenDay;

        if (big == cheapForBig) {
            return 1;
        } else {
            return baseValue * 2 - 1;
        }
    }

    function buyCake() external view returns (uint256 priceInRs) {
        return cakePrice(msg.sender);
    }
}
